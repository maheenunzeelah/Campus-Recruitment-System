const express=require('express');
const router=express.Router();
const mongoose=require('mongoose');
const Company=require("./model/Company");
const JobPosted=require("./model/JobPosted");
var jwt = require('jsonwebtoken');


router.post('/',(req,res)=>{
    var token=req.headers['authorization'];
    var data=req.body;
    
    
    console.log(data);
    try{
    var decoded = jwt.verify(token, 'shhhh');
    console.log("verified", token);
        console.log(decoded);
 
     data.company=decoded.compid;
    
    var job = new JobPosted(data);
    
    job.save()
      
      .then((resolve) => {
        res.send('Job Posted');
        console.log("Resolve: ", resolve);

    })

        .catch((err) => {

            console.log("Error: ", err);

            res.status(500);

            res.send("Something went wrong");

        });
    }
    catch(err){
        res.status(401).send(err);
    }
})

router.get('/viewJob',(req,res)=>{
    var token=req.headers['authorization'];
    try {
        var decoded = jwt.verify(token, 'shhhh');
        var query={
            company: decoded.compid
        }
        JobPosted.find(query,(error,response)=>{
           if(error){
               res.status(500);
               res.send(error);
               return
           }
        console.log(response);
       res.send(response);
        })
       
      } 
    catch(err) {
        res.status(401).send(err);
      }

})


module.exports=router;